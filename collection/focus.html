<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Fractal</title>
    <style>
        body {
            margin: 0;
            background-color: #1a1a1a;
            color: #eee;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        #sidebar {
            width: 300px;
            background-color: #111;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            border-right: 1px solid #333;
            box-shadow: 2px 0 15px rgba(0,0,0,0.5);
            z-index: 10;
        }

        h2 { margin: 0; color: #44ffaa; text-transform: uppercase; letter-spacing: 2px; }

        .timer-display {
            font-size: 64px;
            font-weight: bold;
            color: white;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 20px 0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label { font-size: 12px; color: #888; text-transform: uppercase; font-weight: bold;}

        input[type="number"] {
            background: #222;
            border: 1px solid #444;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            text-align: center;
        }

        button {
            padding: 15px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            transition: transform 0.1s, background 0.2s;
            text-transform: uppercase;
        }

        button:active { transform: scale(0.98); }

        .btn-start { background-color: #44ffaa; color: #000; }
        .btn-start:hover { background-color: #33cc88; }

        .btn-reset { background-color: #333; color: #fff; }
        .btn-reset:hover { background-color: #444; }

        .status-msg {
            text-align: center;
            color: #888;
            font-style: italic;
            font-size: 14px;
            margin-top: 10px;
        }

        /* Canvas */
        #canvas-container {
            flex-grow: 1;
            position: relative;
            background: radial-gradient(circle at bottom center, #223322 0%, #000000 80%);
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>Focus Fractal</h2>
        
        <div class="timer-display" id="timerDisplay">25:00</div>

        <div class="control-group">
            <label>Session Length (Minutes)</label>
            <input type="number" id="minutesInput" value="25" min="1" max="120">
            
            <button class="btn-start" id="startBtn">Plant Seed</button>
            <button class="btn-reset" id="resetBtn">Uproot (Reset)</button>
        </div>

        <div class="status-msg" id="statusMsg">Ready to focus?</div>
    </div>

    <div id="canvas-container">
        <canvas id="fractalCanvas"></canvas>
    </div>

<script>
    const canvas = document.getElementById('fractalCanvas');
    const ctx = canvas.getContext('2d');
    
    // UI Elements
    const timerDisplay = document.getElementById('timerDisplay');
    const minInput = document.getElementById('minutesInput');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const statusMsg = document.getElementById('statusMsg');

    // Add Demo Button dynamically if it doesn't exist
    let demoBtn = document.getElementById('demoBtn');
    if (!demoBtn) {
        demoBtn = document.createElement('button');
        demoBtn.id = 'demoBtn';
        demoBtn.textContent = "âš¡ Demo Mode (10s)";
        demoBtn.style.background = "#ffcc00";
        demoBtn.style.color = "#000";
        demoBtn.style.marginTop = "10px";
        // Insert after the input box
        document.querySelector('.control-group').appendChild(demoBtn);
    }

    // State
    let totalTime = 25 * 60;
    let timeRemaining = 25 * 60;
    let isRunning = false;
    let timerInterval = null;
    let progress = 0;
    let windAngle = 0;
    let speed = 1000; // Normal speed (1 second)

    function resize() {
        canvas.width = canvas.parentElement.offsetWidth;
        canvas.height = canvas.parentElement.offsetHeight;
    }
    window.addEventListener('resize', resize);
    
    function formatTime(seconds) {
        const m = Math.floor(seconds / 60);
        const s = Math.floor(seconds % 60);
        return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    function updateDisplay() {
        timerDisplay.textContent = formatTime(timeRemaining);
    }

    function startTimer(isDemo = false) {
        if (isRunning) return;

        const inputMins = parseInt(minInput.value) || 25;
        
        // Reset state if we are starting fresh
        if (timeRemaining === 0 || timeRemaining === totalTime || isDemo) {
            totalTime = isDemo ? 10 : inputMins * 60; // 10 seconds for demo
            timeRemaining = totalTime;
        }

        // Speed up the tick for demo mode, or use normal seconds
        speed = isDemo ? 1000 : 1000;

        isRunning = true;
        statusMsg.textContent = isDemo ? "WATCH IT GROW!" : "Tree is growing... Keep working.";
        statusMsg.style.color = "#44ffaa";
        
        // Lock UI
        startBtn.disabled = true;
        startBtn.style.opacity = "0.5";
        demoBtn.disabled = true;
        demoBtn.style.opacity = "0.5";
        minInput.disabled = true;

        timerInterval = setInterval(() => {
            if (timeRemaining > 0) {
                timeRemaining--;
                updateDisplay();
                progress = 1 - (timeRemaining / totalTime);
            } else {
                completeTimer();
            }
        }, speed);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        isRunning = false;
        
        // Reset UI
        startBtn.textContent = "Plant Seed";
        startBtn.disabled = false;
        startBtn.style.opacity = "1";
        demoBtn.disabled = false;
        demoBtn.style.opacity = "1";
        minInput.disabled = false;
        
        progress = 0;
        const inputMins = parseInt(minInput.value) || 25;
        totalTime = inputMins * 60;
        timeRemaining = totalTime;
        
        statusMsg.textContent = "Ready to focus?";
        statusMsg.style.color = "#888";
        updateDisplay();
    }

    function completeTimer() {
        clearInterval(timerInterval);
        isRunning = false;
        progress = 1; 
        statusMsg.textContent = "Session Complete! Well done.";
        statusMsg.style.color = "#fff";
        
        startBtn.textContent = "Plant New Seed";
        startBtn.disabled = false;
        startBtn.style.opacity = "1";
        demoBtn.disabled = false;
        demoBtn.style.opacity = "1";
        minInput.disabled = false;
    }

    // --- Fractal Logic ---

    function drawTree(startX, startY, len, angle, branchWidth, depth) {
        ctx.save();
        ctx.translate(startX, startY);
        ctx.rotate(angle * Math.PI/180);
        
        // Draw Branch
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.quadraticCurveTo(0, -len/2, 0, -len);
        ctx.lineWidth = branchWidth;
        
        if (depth > 8) ctx.strokeStyle = '#5c4033'; // Dark Wood
        else if (depth > 4) ctx.strokeStyle = '#8b5a2b'; // Light Wood
        else ctx.strokeStyle = '#44aa44'; // Green
        
        ctx.stroke();

        if (len < 5 || depth <= 0) {
            // Flowers appear only near the end of the timer (80%+)
            if (progress >= 0.8 && depth <= 1) {
                ctx.beginPath();
                ctx.arc(0, -len, 6 * progress, 0, Math.PI * 2); // Flower grows with progress
                ctx.fillStyle = '#ff69b4';
                ctx.fill();
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ff69b4';
            }
            ctx.restore();
            return;
        }

        const sway = Math.sin(windAngle + depth) * 2; 

        // Recursion
        ctx.translate(0, -len);
        
        // Left
        drawTree(0, 0, len * 0.75, -20 + sway, branchWidth * 0.7, depth - 1);
        // Right
        drawTree(0, 0, len * 0.75, 20 + sway, branchWidth * 0.7, depth - 1);

        ctx.restore();
    }

    function animate() {
        requestAnimationFrame(animate);

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Background Gradient
        const gradient = ctx.createRadialGradient(canvas.width/2, canvas.height, 50, canvas.width/2, canvas.height/2, 800);
        gradient.addColorStop(0, "#223322");
        gradient.addColorStop(1, "#000000");
        ctx.fillStyle = gradient;
        ctx.fillRect(0,0,canvas.width, canvas.height);

        windAngle += 0.02;

        // Ground
        ctx.fillStyle = "#112211";
        ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

        // Always draw the "Seed" if progress is low
        if (progress < 0.05) {
            ctx.beginPath();
            ctx.arc(canvas.width/2, canvas.height - 20, 8, 0, Math.PI*2); // Bigger seed
            ctx.fillStyle = "#8b5a2b";
            ctx.fill();
            
            // Pulsing glow for the seed
            ctx.shadowBlur = 10 + Math.sin(windAngle * 5) * 5;
            ctx.shadowColor = "#44ffaa";
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        // Draw Tree
        // Map progress (0 to 1) to Size (0 to 140)
        // We use Math.max to ensure it doesn't disappear completely during math errors
        const maxLen = 140;
        let currentLen = maxLen * progress;
        
        if (currentLen > 1) {
            drawTree(canvas.width / 2, canvas.height - 20, currentLen, 0, 15 * Math.max(0.1, progress), 10);
        }
    }

    // Listeners
    startBtn.addEventListener('click', () => startTimer(false));
    resetBtn.addEventListener('click', resetTimer);
    
    // Wire up the new Demo Button
    demoBtn.addEventListener('click', () => startTimer(true));

    resize();
    animate();

</script>
</body>
</html>