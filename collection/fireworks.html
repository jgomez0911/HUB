<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fireworks Studio</title>
    <style>
        /* --- GLOBAL STYLES --- */
        body {
            margin: 0;
            background-color: #000;
            color: #eee;
            font-family: 'Segoe UI', Roboto, sans-serif;
            display: flex;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
        }

        /* --- LEFT SIDEBAR (Controls) --- */
        #sidebar {
            width: 280px;
            background-color: #111;
            border-right: 1px solid #333;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
            box-shadow: 5px 0 20px rgba(0,0,0,0.5);
        }

        h2 { margin: 0; color: #ff0055; text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        p.hint { font-size: 12px; color: #666; text-align: center; margin: 0; }

        .control-group {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        label { font-size: 13px; color: #aaa; display: flex; justify-content: space-between; margin-bottom: 8px;}
        span.val { color: #fff; font-weight: bold; }

        input[type="range"] {
            width: 100%;
            accent-color: #ff0055;
            cursor: pointer;
        }

        /* Color Picker Buttons */
        .color-options { display: flex; gap: 5px; justify-content: center; margin-top: 5px; }
        .color-btn {
            width: 30px; height: 30px; border-radius: 50%; border: 2px solid #333; cursor: pointer;
            transition: transform 0.2s;
        }
        .color-btn.active { border-color: #fff; transform: scale(1.2); }
        .c-multi { background: linear-gradient(135deg, #f00, #ff0, #0f0, #00f); }
        .c-red { background: #ff0044; }
        .c-gold { background: #ffcc00; }
        .c-blue { background: #00ccff; }

        /* --- RIGHT CANVAS AREA --- */
        #main-area {
            flex-grow: 1;
            position: relative;
            background: #000;
            cursor: crosshair;
            overflow: hidden;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* --- MOBILE LAYOUT --- */
        @media (max-width: 768px) {
            body { flex-direction: column; }

            /* Canvas Top (60%) */
            #main-area {
                order: 1;
                height: 60dvh;
                border-bottom: 1px solid #333;
            }

            /* Sidebar Bottom (40%) */
            #sidebar {
                order: 2;
                width: 100%;
                height: 40dvh;
                border-right: none;
                padding: 15px;
                
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                align-content: flex-start;
                gap: 10px;
                overflow-y: auto;
            }

            h2, p.hint { display: none; }

            .control-group {
                flex: 1 1 45%; /* 2 items per row */
                height: 70px; /* Fixed height */
                padding: 10px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            /* Make the Color picker full width at bottom */
            .color-group { width: 100%; flex: 1 1 100%; height: auto; flex-direction: row; align-items: center; justify-content: space-between;}
            .color-options { margin: 0; }
        }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2>Fireworks</h2>
        <p class="hint">Click canvas to launch!</p>

        <div class="control-group">
            <label>Gravity: <span id="valGrav" class="val">Normal</span></label>
            <input type="range" id="inGrav" min="0.05" max="0.4" step="0.05" value="0.15">
        </div>

        <div class="control-group">
            <label>Wind: <span id="valWind" class="val">0</span></label>
            <input type="range" id="inWind" min="-5" max="5" step="1" value="0">
        </div>

        <div class="control-group">
            <label>Explosion Size: <span id="valSize" class="val">Large</span></label>
            <input type="range" id="inSize" min="2" max="10" step="1" value="6">
        </div>

        <div class="control-group color-group">
            <label>Color Mode:</label>
            <div class="color-options">
                <div class="color-btn c-multi active" onclick="setColor('multi')"></div>
                <div class="color-btn c-red" onclick="setColor('red')"></div>
                <div class="color-btn c-gold" onclick="setColor('gold')"></div>
                <div class="color-btn c-blue" onclick="setColor('blue')"></div>
            </div>
        </div>
    </div>

    <div id="main-area">
        <canvas id="fwCanvas"></canvas>
    </div>

<script>
    const canvas = document.getElementById('fwCanvas');
    const ctx = canvas.getContext('2d');

    // UI Refs
    const inGrav = document.getElementById('inGrav');
    const inWind = document.getElementById('inWind');
    const inSize = document.getElementById('inSize');
    const valGrav = document.getElementById('valGrav');
    const valWind = document.getElementById('valWind');
    const valSize = document.getElementById('valSize');

    // Update UI Text
    inGrav.oninput = () => valGrav.innerText = inGrav.value;
    inWind.oninput = () => valWind.innerText = inWind.value;
    inSize.oninput = () => valSize.innerText = inSize.value;

    let currentColor = 'multi';
    function setColor(mode) {
        currentColor = mode;
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`.c-${mode}`).classList.add('active');
    }

    // --- PHYSICS ENGINE ---
    let fireworks = [];
    let particles = [];
    let timer = 0;

    function resize() {
        canvas.width = canvas.parentElement.offsetWidth;
        canvas.height = canvas.parentElement.offsetHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // 1. The Rocket (Goes Up)
    class Firework {
        constructor(targetX, targetY) {
            this.x = canvas.width / 2; // Start center bottom
            this.y = canvas.height;
            this.targetX = targetX;
            this.targetY = targetY;
            
            // Calculate distance and speed
            const distance = Math.sqrt(Math.pow(targetX - this.x, 2) + Math.pow(targetY - this.y, 2));
            const speed = 15; // Launch speed
            
            const angle = Math.atan2(targetY - this.y, targetX - this.x);
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            
            // Trail particles color
            this.hue = Math.random() * 360; 
            if(currentColor === 'red') this.hue = 340 + Math.random()*40;
            if(currentColor === 'gold') this.hue = 40 + Math.random()*20;
            if(currentColor === 'blue') this.hue = 200 + Math.random()*60;
        }

        update(index) {
            this.x += this.vx;
            this.y += this.vy;

            // Apply slight gravity to rocket
            this.vy += parseFloat(inGrav.value) * 0.5;

            // Check distance to target (Simple check: if we pass the target Y or start falling)
            // Or simpler: if velocity turns positive (starts falling)
            if (this.vy >= -2 || this.y <= this.targetY) {
                // EXPLODE!
                createParticles(this.x, this.y, this.hue);
                fireworks.splice(index, 1);
            }
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
            ctx.fillStyle = `hsl(${this.hue}, 100%, 70%)`;
            ctx.fill();
        }
    }

    // 2. The Explosion (Goes Everywhere)
    class Particle {
        constructor(x, y, hue) {
            this.x = x;
            this.y = y;
            this.hue = hue;
            
            // Random spread based on Slider
            const power = parseFloat(inSize.value);
            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * power;
            
            this.vx = Math.cos(angle) * velocity;
            this.vy = Math.sin(angle) * velocity;
            
            this.friction = 0.95; // Air resistance
            this.gravity = parseFloat(inGrav.value); 
            this.alpha = 1;
            this.decay = Math.random() * 0.015 + 0.01; // Fade speed
            this.brightness = Math.random() * 20 + 50;
        }

        update(index) {
            // Physics
            this.vx *= this.friction;
            this.vy *= this.friction;
            this.vy += this.gravity;
            
            // Wind (Only affects particles)
            this.vx += parseFloat(inWind.value) * 0.05;

            this.x += this.vx;
            this.y += this.vy;
            
            // Fade out
            this.alpha -= this.decay;
            if (this.alpha <= 0) {
                particles.splice(index, 1);
            }
        }

        draw() {
            ctx.save();
            ctx.globalAlpha = this.alpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
            ctx.fillStyle = `hsl(${this.hue}, 100%, ${this.brightness}%)`;
            ctx.fill();
            ctx.restore();
        }
    }

    function createParticles(x, y, hue) {
        const count = 50 + parseFloat(inSize.value) * 5; // More particles for bigger bangs
        for (let i = 0; i < count; i++) {
            particles.push(new Particle(x, y, hue));
        }
    }

    // --- ANIMATION LOOP ---
    function animate() {
        requestAnimationFrame(animate);

        // THE TRAIL TRICK:
        // Instead of clearing the canvas, draw a semi-transparent black rect.
        // This makes previous frames slowly fade out, creating trails.
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // LIGHTER MIX BLEND MODE (Makes overlaps glow)
        ctx.globalCompositeOperation = 'lighter';

        // Update & Draw Fireworks (Rockets)
        for (let i = fireworks.length - 1; i >= 0; i--) {
            fireworks[i].draw();
            fireworks[i].update(i);
        }

        // Update & Draw Particles (Explosions)
        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].draw();
            particles[i].update(i);
        }

        // Auto-Launch Random Fireworks every ~40 frames
        timer++;
        if (timer > 40) {
            const rx = Math.random() * canvas.width;
            const ry = canvas.height * 0.2 + Math.random() * (canvas.height * 0.4);
            fireworks.push(new Firework(rx, ry));
            timer = 0;
        }
    }

    // --- INPUTS ---
    canvas.addEventListener('mousedown', (e) => {
        const r = canvas.getBoundingClientRect();
        fireworks.push(new Firework(e.clientX - r.left, e.clientY - r.top));
    });
    
    // Touch support for mobile tapping
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault(); // Stop zoom
        const r = canvas.getBoundingClientRect();
        const t = e.touches[0];
        fireworks.push(new Firework(t.clientX - r.left, t.clientY - r.top));
    }, {passive: false});

    animate();

</script>
</body>
</html>